# EU4 GUI Province Editor
Created by [Jakub21](https://github.com/Jakub21)  
Editor [GitHub Repository](https://github.com/Jakub21/EU4-GUI-Province-Editor)  
Program is licensed under MIT License  
Development started February 2018



# Setup

### Python
Program was developed for [Python 3.6](https://www.python.org/). As of May 2018 program was not tested with other versions of Python.

### Packages
The following Python packages (and their dependencies) are required to run the program:
- [Pandas](https://pandas.pydata.org/)
- [wxPython](https://www.wxpython.org/)
- [PyYAML](https://pyyaml.org/)

### Executable
To run program execute `Editor.pyw` with Python 3. To open real-time logging console in background execute `Debug.py` instead. No arguments are taken.

### First use
When program is launched for the first time, a Configurator will start. Selecting assignment and localisation files is mandatory. Check [Configurator Section](#configurator) for detailed description.



# General usage

### Top bar
Top bar consists of 5 menus.
- `Main` menu's options:
    - `Run Configurator`: open [Confugurator](#configurator)
    - `Load Commands`: load [Commands File](#commands-file)
    - `Quit`: Leave program, any unsaved changes are lost.
- `File` menu's options:
    - `Load Sheet` load data from CSV spreadsheet
    - `Load Original` load data from directory (original-like files)
    - `Update with Sheet` update current program data with contents of spreadsheet
    - `Update with Original` update current program data with contents of directory
    - `Save to Sheet` save data to CSV spreadsheet
    - `Save to Original` save data to directory (original-like files)
    - `Save to Original / Changed` same as above but only provinces that were modified
- `Selection` menu's options:
    - `New Selection` create new selection
    - `Sub Selection` create new selection only with provinces from the current one
    - `Append` append provinces to current selection
- `Sort` menu's options:
    - `Sort by ID` sort provinces by their IDs
    - `Sort by Location` sort provinces by location (regions and areas)
- `Modify` menu's options:
    - `Modify Column` modify column in whole selection
    - `Modify Province` modify single cell

### Commands bar
Commands bar is where [commands](#commands) are to be entered.

### Side bar
Side bar contains various buttons. It is here for future use. The buttons there are just for tests.

### Central frame
Program displays data representation in central frame. Representation is generated by Pandas package.



# Configurator
To open configurator, on top bar, click `Main` menu and choose `Run Configurator` option.

### Files
Editor needs 4 files from game directory to work properly. This is list of these files and their paths in game directory. Program does not modify them.
- Area assignment file `game/map/area.txt`
- Region assignment file `game/map/region.txt`
- Super-region assignment file `game/map/superregion.txt`
- Province names localisation file for which user can choose any language version `game/localisation/prov_names_l_LANG.yml`

### Display
Program displays data representation in frame in the center of main window. In configurator there are a few options that affect the way program does it. These are:
- `Font size`: Modifies font size in representation frame.
- `Hide provinces with no super-region`: If checked, provinces that are not assigned to any super-region will not be displayed.
- `Hide provinces with specified super-regions`: If checked, provinces that are assigned to super-region listed in `Hidden super-regions` will not be displayed
- `Hidden columns`: List of super-regions to hide.



# Commands
Program can receive commands from Command Line as well as Command Files. This section explains how to use commands.

#### Symbols used in list of commands
`[]` - Required argument,  
`{}` - Conditional argument,  
`*` - Argument supports multiple values  

### List syntax
Commands parser supports lists. If argument allows multiple values, wrap those values in square brackets `[]`. See examples below:
```
select sub area [champagne ile_de_france]
in prov [183 4389] fort yes
```

### Comments
To add comment in Commands File use `>#`. Comments end when next `>` character is found. Example:
```
> command
># This is comment
Comments ignore newlines
> command
```

### Command Files
In command files, each command should start with `>`. First word of every command should be preceded with space. Example:
```
> select new culture westphalian
```

### Filestream Commands
#### Load
`[type]` argument only can have values: `sheet`, `orig`  
`[path]` path of directory/sheet to load data from  
`{date}` argument is only required if `[type]` has value `orig`
```
load [type] [path] {date}
load sheet sample.csv
```

#### Load-Update
`[type]` argument only can have values: `sheet`, `orig`  
`[path]` path of directory/sheet to load data from  
`{date}` argument is only required if `[type]` has value `orig`  
```
loadu [type] [path] {date}
loadu orig samples/provinces 1642.7.3
```

#### Save
`[type]` argument only can have values: `sheet`, `orig`, `diff`  
`[path]` path of directory/sheet to save data to
```
save [type] [path]
save diff samples/result
```

### Data Manipulation Commands
#### Select
`[mode]` Selection mode. Valid values: `new` `sub` `app`.  
`[column]` Name of column to search for values in  
`[value]*` Provinces with this value will be added to selection  
```
select [mode] [column] [value]*
select new area slovakia
```

#### Sort
Sorts provinces. Available sorting modes are `loc` - by location and `id` - by id. Provinces are automatically sorted by location every time data is loaded.
```
sort [mode]
sort id
```

#### Set
In current selection, changes all values in specified column to specified value.  
`[column]` specifies column  
`[value]` specifies value  
```
set [column] [value]
set culture austrian
```

#### In-scope
Finds provinces with "condition value" in "condition column" and changes all entries in "value column" to "value"
```
in [condition column] [condition value]* [value column] [value]
in regn iberia religion catholic
```

### General Commands
#### Represent
Update central frame with current data
```
repr
```

#### Exit
Leave program, any unsaved changes are lost.
```
exit
```



# Filestream
This section describes how program loads and saves data from storage.

### Spreadsheets
Program can create and read spreadsheets. The only supported format is CSV (comma as separator). Modifying `column-order` list in `conf/static.yml` may make old sheets impossible to read.

### Game-readable files
Also refered to as `original files`.  
In this mode, every file from selected directory is loaded and parsed. Each file is a separate province. Province ID generation is based on a file name. Those are history files so they contain data for various in-game starting dates. Program can only load a single state of history so a date is required. Date format is `yyyy.mm.dd`. Default starting date is stored in  `conf/static.yml` at key `date` and it's  `1444.11.11`.

#### Region names shortening
Provinces are automatically assigned to areas, regions and super-regions. Names of regions are shortened. This action removes region level indicator from a region name. For example `mazovia_area` is changed to `mazovia`. This can be disabled in `conf/static.yml` by changing option `shorten-regn-names` to `false`.

#### Exclusive saving
Only files for provinces with `yes` value in column [`changed`](#was-modified-attribute) will be generated.




# Attributes
List of province attributes.

#### History attributes
Attributes loaded from history files. The current list of them can be found in `conf/static.yml` at key `history-file-keys`. As of June 2018 there are 25 of them.

#### Location attributes
Attributes based on [region assignment files](#files). They define location of a province.

#### Was-modified attribute
Program stores it in column `changed`. After data is loaded from original files column is empty. When a province (row) is modified, a cell in this column is automatically set to `yes`. This column is required for [exclusive save mode](exclusive-saving) to work properly. Column's content is saved to spreadsheets. Saving data to a spreadsheet and then loading from it again will not cause column to reset.

#### Group attribute
The group column can be freely used by user. User can, for example, create specific sets of provinces that are frequently used or require complex procedure to re-create.

#### Province name
Province name loaded from [localisation file](#files). Its purpose is for user to be able to recognize provinces. Changing it has no effect on in-game localisation.

#### Source file name
The `filename` attribute stores name of source file a province was loaded from. Storing original names instead of generating new ones is better because of the way the game loads mods. Data from files with other names would not overwrite original data, possibly causing problems.
